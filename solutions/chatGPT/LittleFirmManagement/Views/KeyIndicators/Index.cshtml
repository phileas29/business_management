@{
    int selectedGranularity = (int)ViewData["SelectedGranularity"];
    int selectedDetails = (int)ViewData["SelectedDetails"];
    decimal[,] data = (decimal[,])ViewData["Data"];
    var labels = ((IEnumerable<dynamic>)ViewData["Labels"]).ToList();
    int n = (int)ViewData["N"];
}
<h1>Key indicators</h1>


<div class="container">
    <div class="row">
        <div class="col-12">
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    @foreach (KeyValuePair<int, string> g in ViewBag.GranularityMapping)
                    {
                        <li class="page-item @(g.Key == @selectedGranularity ? "active" : "")">
                            <a class="page-link" href="/KeyIndicators/Index?selectedGranularity=@(g.Key)&selectedDetails=@selectedDetails">@(g.Value)</a>
                        </li>
                    }
                </ul>
            </nav>
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    @foreach (KeyValuePair<int, string> g in ViewBag.DetailsMapping)
                    {
                        <li class="page-item @(g.Key == @selectedDetails ? "active" : "")">
                            <a class="page-link" href="/KeyIndicators/Index?selectedGranularity=@selectedGranularity&selectedDetails=@(g.Key)">@(g.Value)</a>
                        </li>
                    }
                </ul>
            </nav>

            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th></th>
                            @if(selectedDetails != 0) {<th></th>}
                            @for (int i = 0; i < data.GetLength(1); i++)
                            {
                                DateTime startDate = ((DateTime)ViewData["Begin"]).AddMonths(i * n);
                                <th>@startDate.ToString("yyyy")<br>@startDate.ToString("MMMM")</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @for (int row = 0; row < data.GetLength(0); row++)
                        {
                            <tr>
                                <th>@labels[row].ct</th>
                                @if (selectedDetails != 0)
                                {
                                    <th>@labels[row].c</th>
                                }
                                @for (int month = 0; month < data.GetLength(1); month++)
                                {
                                    decimal amount = data[row,month];
                                    if (amount == 0)
                                    {
                                        <td></td>
                                    } else {
                                        <td>@amount.ToString("0.00")</td>
                                    }
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>